\documentclass[12pt]{report}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amssymb,amsfonts} % Required for some math elements, equation environment and inline $ (math) $
\usepackage{makeidx}
\usepackage{graphicx} % Required for the inclusion of images
\usepackage{txfonts}
%\usepackage{times} % Uncomment to use the chosen font 
\usepackage[skip=5pt,font={small,it},labelfont=bf]{caption}
\usepackage{subcaption}
\usepackage{siunitx} % Provides the \SI{}{} and \si{} command for typesetting SI units 
\usepackage{color}
\usepackage[english]{babel} %%% SPRAWDZANIE PISOWNI EN
%\usepackage[polish]{babel} %%% SPRAWDZANIE PISOWNI PL

%%% PAGE HEADERS COMMANDS %%%
\usepackage{fancyhdr} % Page Headers and Footers
\pagestyle{fancy} %page style with FancyHDR package
\fancyhf{} % clear the header/footer style
\lhead{\leftmark} % hdr left - standard marking (chapter names)
\rhead{\thepage} % hdr right - page numbering
%\setlength{\textwidth}{14cm}
\setlength{\textheight}{20cm} 

% BIB REF COMMANDS
\usepackage[nottoc,notlot,notlof]{tocbibind}
\usepackage[backend=bibtex,style=alphabetic,sorting=anyvt]{biblatex}  
\addbibresource{references.bib}
%Bibliography sorting options 
%option	description
%nty	sort by name, title, year
%nyt	sort by name, year, title
%nyvt	sort by name, year, volume, title
%anyt	sort by alphabetic label, name, year, title
%anyvt	sort by alphabetic label, name, year, volume, title
%ydtn	sort by year (descending), name, title
%none	entries are processed in citation order

% CODE LISTINGS COMMANDS
\usepackage{verbatim} % Pre-formatted text environment 
\usepackage[linesnumbered,ruled,vlined]{algorithm2e} % Algorithms with ctan algorithm2e 
\usepackage{listings}
\definecolor{mygray}{rgb}{0.4,0.4,0.4}
\definecolor{mygreen}{rgb}{0,0.6,0.4}
\definecolor{myorange}{rgb}{0.8,0.2,0}
\lstset{ 
	basicstyle=\footnotesize\sffamily\color{black},
	keywordstyle=\color{mygreen},
	commentstyle=\color{mygray},
	identifierstyle=\color{blue},
	stringstyle=\color{myorange},
	numbers=left,
	numbersep=5pt,
	numberstyle=\tiny\color{mygray},
	frame=tbTB,
	breakatwhitespace=false,         
	breaklines=true,                 
	captionpos=t,                    
	keepspaces=true, 
	columns=fullflexible,
	showstringspaces=false,
	float=t,
	tabsize=2,
	title=\lstname,
	caption=\lstname,
	language=C++
} 


%\newtheorem{definition}{Definicja} % przykład nowego środowiska 
%\newtheorem{example}{Przykład}[chapter] % przykład nowego środowiska 
%\newtheorem{corollary}{Wniosek}[chapter] % przykład nowego środowiska 

%%% TO DO notes
\usepackage[textsize=footnotesize]{todonotes}
% \usepackage[disable]{todonotes}
\newcommand{\td}[1]{\todo[inline]{TO DO: #1}}

%%% TOC HYPERLINKS %%%
\usepackage{hyperref}
% remember to use \tableofcontents after title
\hypersetup{
	colorlinks,
	citecolor=black,
	filecolor=black,
	linkcolor=black,
	urlcolor=black,
	pdftitle={Generating two-dimensional game maps with use of cellular automata},
	bookmarks=true 
}  

%%% STRONA TYTUŁOWA - DANE
\title{Generating two-dimensional game maps with use of cellular automata}
\author{Michał Wolski}

\begin{document}

\maketitle
\renewcommand{\contentsname}{Table of contents}
\tableofcontents 

\listoftodos

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Introduction} \label{rozdzial.wstep} 
During recent years, presence of computer games in human lives has increased. The amount of time spent on playing games by the modern society has shown that games are desirable both as a means for entertainment and a medium of expression. However, as the interest in games rises \footnote{The Interactive Software Federation of Europe compiles and publishes statistics which include frequency of gaming in European countries and show that demand for games is on the rise. \url{https://www.isfe.eu/industry-facts/statistics}} and computer games become increasingly complex, the need for game content must also rise. Elements such as believable maps, textures, sound and models (among other types of content) are a necessary resource for production of games. 

Studies such as \autocite{hendrikx2013procedural} show where the evidence for insufficiency of manual content creation may be found. In the study, authors point to work of Kelly and McCabe \autocite{kelly2007citygen}, Lefebvre and Neyret \autocite{lefebvre2003pattern}, Smelik et al. \autocite{smelik2009survey} and Iosup \autocite{iosup2009poggi} as sources which reveal game content production as a time-consuming and expensive endeavour. Hence, it is logical to conclude that information contained in studies and statistics on the topic of game development suggest that most projects aimed at creating games or simulations could benefit from seeking new or more efficient automated means of content creation.

\subsubsection{Solving the inefficiency issue}
In order to provide a solution to the inefficiency of manual content production, formal methods have emerged and are commonly referred to as procedural generation techniques, defined by the literature as processes or methods of automatic content creation, through algorithmic mechanisms \autocite{togelius2011search} \autocite{yannakakis2015experience}.

Scientific surveys such as \autocite{hendrikx2013procedural} and \autocite{smelik2009survey} show why investigating procedural generation is useful for the game industry, by providing examples of successful methods which can be used to generate content for games. Primary concerns which drive the interest in automated ways to create game content are the rising project costs and increasing development time.

In order to reduce the cost of game development, allow for greater replay value or provide a feeling of vastness to the game worlds that designers aim to create, procedural content generation techniques can provide an attractive solution to the problem of content creation. Surveys such as \autocite{hendrikx2013procedural}, \autocite{togelius2011search} and \autocite{de2011survey} show what types of game content can be generated and are a good starting point for seeking methods of procedural generation.
 
%%%%%%%%%%%%%%%
\section{Objectives}

This thesis focuses on automated creation of 2-dimensional game maps using a cellular automata approach to generate small map tiles and merge them into a bigger map. Such approach allows for a degree of control to the map designer -- who may want to decide which tiles will be merged and at which locations in the map they will be present. Integrating manual editing or parametrization of desired results with procedural generation techniques has been proposed before in the works concerning procedural generation techniques \autocite{bidarra2010integrating}, \autocite{smelik2010integrating}, \autocite{smelik2011declarative}. 

Beginning experimentation with flat maps on 2-dimensional plane avoids the complexity that may arise when dealing with higher dimensions, hence the main aim is to develop a solution to the problem of automating planar map creation for games. 

Specifically, maps created by the generator should be planar and their layout must have characteristics of shapes that can be helpful in design of believable environments. These characteristics may include irregularity, asymmetry and imbalance. The goal is to create structures that are interesting because of their unpredictability, somewhat resembling the look of results produced by natural processes like erosion, dissolution, deformation, tectonic fragmentation or weathering.
 
%%%%%%%%%%%%%%%
\section{Thesis scope}

The research carried out to support this thesis was focused on discovery of generative techniques presented in current literature describing methods of content generation for games. 

Work on preparing the solution has been divided into the following parts, described in the remainder of this thesis:

\begin{itemize}
	\item research on procedural generation of planar maps and method selection
	\item design of a map generator program and its implementation in C++
	\item experiments to find a set of rules that generate satisfying maps
	\item extending the feature set of the generator
\end{itemize}

\td{review scope after thesis body is done >> scope well defined? scope matches content?3}

%%%%%%%%%%%%%%%
\section{Thesis structure}
This thesis includes introduction followed by three chapters. Chapter \ref{rozdzial.teoria} serves as a study on possible mechanisms that could be used for procedural generation and specifically, for creation of 2D maps for games. Chapter \ref{rozdzial.praktyka} describes design and implementation of a solution to the problem along with performed experiments. Chapter \ref{rozdzial.podsumowanie} summarizes the findings and concludes the thesis.

%%%%%%%%%%%%%%%
\section{Experimental setup}

The solution that allowed to carry out experiments in this thesis was implemented using the C++ programming language and compiled with MSVC++ 14.0 compiler, natively included in the VS2015 IDE. Other tools and libraries used in the project:

\begin{itemize}
	\item Dear ImGui, by Omar Cornut - to easily build an Immediate Mode user interface. Project homepage:  \url{https://github.com/ocornut/imgui}
	\item GLFW 3.2.1 library - to create an OpenGL context and have direct access to texture functions. Project homepage: \url{http://www.glfw.org/} 
	\item \td{SFML not used}
\end{itemize}  

In order to satisfy requirements for using OpenGL API function calls, it is recommended to use a dedicated graphics processing unit and install updated drivers. For the purposes of development and experiments \textit{nVidia GeForce GTX 560M } was used and drivers were updated to latest available versions.
 
This thesis has been prepared with \LaTeX\space system for document typesetting, included diagrams were drawn with \textit{UMLet} - an open source modelling program.
 

%%%%%%%%%%%%%%%
\section{Abbreviations and acronyms} 

The following terms, abbreviations and acronyms have been used in the thesis.

\begin{description}
	\item[CA] Cellular Automaton. A simulation consisting of cell objects.
	\item[PCG] Procedural Content Generation. An automated process of creation.   
	\item[GUI] Graphical User Interface
	\item[ASCII] American Standard Code for Information Interchange - a character encoding standard, used to represent characters in computers and information systems
	\item[RPG] Role-Playing Game
	\item[] \td{ review thesis, find unexplained acronyms }  
\end{description}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Research on 2D map generation methods} \label{rozdzial.teoria}

%%%%%%%%%%%%%%%
\section{Maps and cartography} 

Historically, maps have been used by the human race since ancient times. The need for navigation in the world has been a driving force behind the evolution of maps. Starting with cave paintings and representations of stars on the sky, our kind had the need for capturing an abstract model of a territory, terrain shape, location of useful resources or some other aspect of surrounding environment in a useful way.

Making a model of the physical (or fictional) world with maps requires choice of the data types describing locations represented on the map. List of data types visualized with maps has been growing with the evolution of cartography and whenever new technologies have been introduced to the map making crafts. Some examples of data possible to represent on maps are:
 
\begin{itemize}
	\item physical maps - terrain shape, elevation, forests, bodies of water, etc.
	\item political maps - borders around a territory, districts, states
	\item climate and weather maps - temperature, humidity, precipitation, wind currents
	\item geologic maps - terrain features, location of precious resources underground
	\item star maps - views of the distant cosmic objects measured by solid angles from a fixed point
	\item route maps - transport links, connections joining points on the modelled territory
\end{itemize}

Although early maps had the form of drawings or etchings on surface of solid materials, now there are other possibilities of representing the abstract model which a map aims to represent. The rise of digital maps and geographic information systems has opened new possibilities - maps have become dynamic entities, stored digitally, easily updated with new data and not limited to the boundaries of physical model. With digital maps, it is possible to show more than one layer of data, as chosen by the user, whereas physical maps are limited to the data and view scale chosen initially at the time when map was crafted. Despite the limitations, they still can serve well as a medium for storage of geographic information, requiring simpler processes during archival and conservation efforts \autocite{bagrow2017history}.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.6\linewidth]{images/journal_netw_talk_map}
	\caption{Pure data map showing the geography of talk in Great Britain. Authors measured the total talk time via communication networks between areas in Britain and used the data to produce the visualzation. Source article: \autocite{10.1371/journal.pone.0014248}}
	\label{fig:journalnetwtalkmap}
\end{figure}


Digital technology has also brought interesting methods to the art of crafting maps, allowing for new types of maps to be crafted, which brought previously undiscovered insights into the nature of represented territories. For example, with data maps such as the one described by article \autocite{10.1371/journal.pone.0014248} it is possible to draw more useful borders around regions, fitting actual human interaction groups as opposed to those defined by past governments, as shown in figure \ref{fig:journalnetwtalkmap}. Maps like these are generated from vast data sets, collected and stored in databases - an approach that would not be possible without use of digital technology. Since maps can emerge out of pure data, the same approach can be used to create fictional maps, out of generated data.

The possibility of visualizing map layers which could not have been created and shown without digital data processing techniques and ease of experimentation with the information and algorithms used to create modern digital maps have also made it apparent that the source data for the layer itself do not necessarily have to measure some aspect of reality, but can be generated using mathematical methods. Such approach effectively allows for creation of fictional maps, representing imaginary territories. With that in mind, let us now move on to the sphere of fictional maps and their use in games, physical and digital alike. 


%%%%%%%%%%%%%%%
\section{Maps in games} 

It is not clear what kind of game was the first one in history to use a map to represent the game world, however two notable examples may easily come into mind: Chess and Go, which are both widely known around the world. 

Chess, a board tactical war-game developed before 6th century AD, uses black-white board as the map of its world. Although the environment represented by a chess board is very simple, it has some important features and rules. The map is composed of square cells, which are arranged on 8 by 8 grid, effectively creating a rigid boundary around the game world, which according to game rules - cannot be crossed. Each cell has 8 neighbours and can be occupied by only one game piece.

Another game, originating from ancient China, defines a similar, grid-based game world, effectively making a map of a uniform planar territory. Go is played on 19 by 19 board, however smaller board sizes are used as well. In Go, the goal is to capture more territory than the opponent, which is done by placing game pieces on line intersections, one piece per turn.


\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.4\linewidth}
		\centering
		\includegraphics[width=\textwidth]{images/chessboard}
		\caption{Chess board} 
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.4\linewidth}
		\centering
		\includegraphics[width=\textwidth]{images/goboard}
		\caption{Go board} 
	\end{subfigure} 
	\caption{Chess and Go both use planar boards divided into tiles by a square grid - simple maps to represent the environment in which game is played.}
	\label{fig:neighborhood_types}
\end{figure}
 
Another interesting example of a game world map is the multi-player strategy board game Risk, invented in 1957 by Albert Lamorisse, where the map represents a territory divided into regions, which must be captured by players in order to win. Risk game shows how a political world map with imagined region borders can be creatively used in a game, as a resource for the players to fight over. The game of Risk has been since published in many variations. Most of them share the same gameplay goal: to capture more territory than the opponents do, which is an example of how a game might use environments represented by maps as a limited resource for players to acquire.
 
\begin{figure}[h]
	\centering
	\includegraphics[width=0.5\linewidth]{images/risk-rulebook} 
	\caption{Risk rule book fragment, containing a photo of the game board. The board shows a world map with fictional political borders, dividing the map into regions, which serve as a resource for players to capture. Image source: photo taken from original Risk rule book, copyright Hasbro 1993}
	\label{fig:acrord32risk1}
\end{figure}

Modern board games have introduced many new ideas to the design of game boards. One example of such ideas is bringing modularity into the board design, composing pieces of the board similarly to how a jigsaw puzzle is composed of singular pieces. Such arrangement allows for greater value in replaying the game, since the game world can be different at each time the game is played. 

An example of such game is Carcassonne, published in 2000, designed by Klaus-Jürgen Wrede in Germany. The game of Carcassonne involves an interesting mechanism: rather than having a fixed game board, cards with tiles are used to construct the board during gameplay. The game rules around tile placement can be thought of as an algorithm of procedural generation: only one tile can be placed during each game turn, adjacent to other tiles, forming a connection with features that tiles represent - roads must connect to roads, fields to other fields, and cities to cities. The rules ensure that the players will develop the game board as the game progresses, which leads to an interesting observation: each turn, the players are presented with new territory to consider in their decisions - and since the game requires players to deploy their resources onto the constructed game map in order to accumulate score and eventually win, these decisions may often become quite challenging with increasing complexity of the board layout. There is a web version of Carcassonne available at \url{https://concarneau.herokuapp.com/game}.

\begin{figure}[h]
	\centering
	\includegraphics[width=0.7\linewidth]{images/carcassonne}
	\caption{Carcassonne game board during gameplay. Players place tiles on gameplay surface once per turn, making sure that each new tile is compatible to surrounding tiles. Image source: \url{https://deerfieldlibrary.org/2016/01/carcassonne-a-modern-board-game-for-adults-teens/}}
	\label{fig:carcassonne}
\end{figure}

There are other board games which make use of generative mechanics to create or alter the board layout, before or during gameplay. Some of them rely on randomness, while others introduce rules by which the game world may be altered. An example of such rules is presented by Labirynth, a board game designed by Max Kobbert and first released by Ravensburger company in 1986. The game board in Labirynth represents a dungeon composed of tiles representing path elements: corners, straight paths, crossings. Each turn, the game board is altered by shifting an entire row or column of movable tiles in a direction chosen by player, in effect changing the board layout.  

 \begin{figure}[h]
 	\centering
 	\includegraphics[width=0.7\linewidth]{images/labirynth}
 	\caption{Labirynth game board. Even rows and columns are movable (marked with a yellow triangle on board edges). Image source: \url{https://rulesofplay.co.uk/products/labyrinth} }
 	\label{fig:carcassonne}
 \end{figure}


While it is possible to find or develop interesting mechanics for board games, some more complex game rules and ideas are better implemented using computer simulation, where most of the mundane tasks which do not contribute to gameplay can be automated. Random number generation, board preparation and arrangement, checking player moves against game rules - all those activities are good candidates for automation. The other reason to simulate games may be to develop artificial intelligence algorithms which can simulate player behaviour at a chosen level of competitive play, effectively providing a way for beginners who want to learn the game they are interested in or for veterans who want to develop their skills further, as has been done for chess and other classic board games. 

Among modern board games, there are many more examples which involve interesting mechanics, but their description lies beyond the scope of this thesis project. Moving on to the next section, let us investigate a few examples of computer games and simulations, where maps are used to construct some aspects of gameplay.

%%%%%%%%%%%%%%%
\section{ Interactivity and automation }

The evolution of personal computers has allowed players to enjoy a new form of entertainment - video and computer games. Possibility of performing real-time simulations on computers and development of computer graphics rendering techniques have created a new medium of expression in the form of computer software. At the time when early forms of interactive simulations were created, first computer games were also developed. 

In the past decades since the first computer games emerged, an industry focused on the craft of game development has emerged. The efforts of modern game designers and developers have lead to creation of multiple game genres and have driven the evolution of mechanics and challenges that modern games offer to players.

As stated in chapter \ref{rozdzial.wstep}, the context of this thesis does not deal with projections of 3D objects onto a plane, like the fields of geography and cartography do, as shown by works similar to \autocite{snyder1993flattening}. The goal is to generate planar maps, which makes games that include them of particular interest for finding examples of working solutions to the problem. 

Early examples involving procedurally created maps are Rogue and Nethack, dungeon crawling games developed in 1980s. Both examples generate a set of rooms with randomized dimensions, which are then connected to each other by a system of corridors, as shown in figure \ref{fig:nethack}.
 

\begin{figure}[h]
	\centering
	\includegraphics[width=0.7\linewidth]{images/nethack}
	\caption{An exemplary level, generated by Nethack game rules. Image source: Nethack project webpage, \url{https://nethack.org/common/index.html}}
	\label{fig:nethack}
\end{figure}

Dungeon layouts generated by Rogue or Nethack could be described as suitable for representing indoor spaces, maps produced by connecting rooms are typically do not contain irregular shapes like landmass forms found in depictions of natural terrain. It is however, possible to use such mechanisms anyway. Generated levels found in Diablo series, Torchlight, Path of Exile and a few other similar action-RPG titles suggest that careful design of map components (textures, tiles, rooms) processed later by a generation mechanism can produce believable environments, regardless of what shapes are shown by a map of their layout. 
	

%%%%%%%%%%%%%%%
\section{Existing solutions for generating planar maps}

There have been scientific surveys conducted on PCG methods, which describe approaches to map generation employed in the past by successful game development projects. Contents of three such surveys are summarized in the following paragraphs.

Authors of the survey \autocite{hendrikx2013procedural} point to other works for deeper exploration into techniques involving generative grammars, genetic algorithms and hybrid methods for generating indoor spaces. For synthesizing outdoor maps, survey lists usage of image filtering, tiling, layering, fractals, Voronoi diagrams and cellular automata. In both cases, pseudo-random number generation and hybrid approaches are listed as tools which can be helpful in finding a promising solution. 

Survey \autocite{de2011survey} explores the subject of environmental content, listing and describing methods for generation of landscapes, continents, cityscapes, road networks and rivers. Terrain generated with presented methods has the properties of naturally occurring land features with surface roughness resembling real environments.

Survey \autocite{van2014procedural} focuses on generation of dungeon levels, listing and describing how cellular automata, generative grammars, genetic algorithms and constraint-based methods are used to create maps containing features of indoor spaces.

The following sections shortly describe each approach and discuss the possibility of applying it to generation of planar maps with irregular shapes.

\subsection{Cellular automata}
A cellular automaton (further abbreviated as CA) is a simulation in which every object in a mathematically defined space is being updated at every step of a simulation. Historically, cellular automata and their properties have been studied since the time of first electronic computers \autocite{Sarkar:2000:BHC:349194.349202}. One of the most complete sources on cellular automata is a book summarizing research on CA carried out by Stephen Wolfram since 1980s \autocite{wolfram2002new}, where a classification of cellular automata is shown along with examples for each kind of CA. 

Specifically, 2-dimensional automata operate on a grid of cells with arbitrary discrete dimensions. Each cell in the grid has neighbours, which may be relevant to the simulation rules. Depending on the type of rules which are used by a particular CA, a different type of cell neighbourhood may be used. To present this concept concisely, a short list of definitions follows.

\begin{description}
	\item[CA] Cellular Automaton (or Automata)
	\item[Cell] Cells are units of state in CA simulation - they are represented in memory by a simple data type: a binary digit, an integer - or more complicated data types: a real number with constraints, a complex number, a custom data structure.  
	\item[Cell neighborhood] In a context of a 2D square grid of cells, neighbourhood is a collection of cells nearest to the selected one.
	\item[Von Neumann neighbourhood] Includes the cell and its immediate neighbours - one to the north, south, east and west of the cell, as shown in figure \ref{fig:neighborhood_types}.
	\item[Moore's neighbourhood] Includes 8 closest neighbours of the cell - immediate and diagonal, as shown in figure \ref{fig:neighborhood_types}.
\end{description}
 
\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.4\textwidth}
		\centering
		\includegraphics[width=0.5\textwidth]{images/neighborsmoore}
		\caption{Moore neighborhood} 
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.4\textwidth}
		\centering
		\includegraphics[width=0.5\textwidth]{images/neighborsvonneumann}
		\caption{Von Neumann neighborhood} 
	\end{subfigure} 
	\caption{Two basic types of cell neighborhood}
	\label{fig:neighborhood_types}
\end{figure}


Every CA simulation uses rules which drive the process of cell evolution to its next stage. Typically, such rules define how board elements must be changed once a specific cell arrangement is recognized. The set of rules must cover all possible neighbourhood patterns of a cell so that the value of each cell in a future step is unambiguous. Exemplary rules for a 2D cellular automaton are presented in figure \ref{fig:examplecarules}, where included images do not cover all possible cases.


\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.4\textwidth}
		\centering
		\includegraphics[width=0.5\textwidth]{images/rule0dead}
		\caption{Rule 0 - cell is set to empty when no neighbours are present} 
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.4\textwidth}
		\centering
		\includegraphics[width=0.5\textwidth]{images/rule2dead}
		\caption{Rule 2 - cell is set to empty if there are less than three neighbours} 
	\end{subfigure} 
	\hfill
	\begin{subfigure}[b]{0.4\textwidth}
		\centering
		\includegraphics[width=0.5\textwidth]{images/rule3alive}
		\caption{Rule 3 - cell is set to filled if it has three neighbours} 
	\end{subfigure} 
	\hfill
	\begin{subfigure}[b]{0.4\textwidth}
		\centering
		\includegraphics[width=0.5\textwidth]{images/rule3alive2}
		\caption{Rule 3a - same rule, behavior independent of neighbour positioning} 
	\end{subfigure} 
	\hfill
	\begin{subfigure}[b]{0.4\textwidth}
		\centering
		\includegraphics[width=0.5\textwidth]{images/rule5alive}
		\caption{Rule 5 - cell is set to filled if more than 3 neighbours} 
	\end{subfigure} 
	\hfill
	\begin{subfigure}[b]{0.4\textwidth}
		\centering
		\includegraphics[width=0.5\textwidth]{images/rule6alive}
		\caption{Rule 6 - cell is set to filled if more than 3 neighbours} 
	\end{subfigure} 
	\hfill
	\caption{A subset of rules for an unknown cellular automaton which uses Moore neighbourhood}
	\label{fig:examplecarules}
\end{figure}

Observing the presented subset, it may be intuitive to see rules 3, 5 and 6 as alternate versions of the same rule - setting the cell state according to a simple test - If selected cell has less than 3 neighbours, it becomes empty, otherwise it becomes filled - however, not knowing the full set of rules for this particular automaton, it cannot be concluded if those rules can be reduced in such way. There might be rules for arrangements with 4, 7 or 8 neighbours which fill the cell instead of emptying it or rules that behave differently depending on neighbour positions.


\td{CA for simulations: Game of Life } 
\td{CA map gen, examples: Ultima Ratio Regum, Dwarf Fortress (2006), Minecraft }

\td{MAIN GOAL OF THESIS: generating map with irregular, chaotic shapes for which CA method is sufficient }

One of possible approaches to map generation which can create irregular shapes is the article written by L. Johnson, G. Yannakakis and J. Togelius from IT University of Copenhagen \autocite{johnson2010cellular}. Authors describe rules of a cellular automaton which is able to transform a tile filled initially with random distribution of cells into a map tile with desired properties which can later be merged with other tiles into the game map. Authors define types of cells to indicate which areas of the map are accessible (floor cells) and which are not (rock and wall cells). To achieve better control over the generation process, the following parameters can be altered: 

\begin{itemize}
	\item $r$ - percentage of floor cells in initial state,
	\item $n$ - count of CA generations (steps) to perform,
	\item $T$ - neighbourhood threshold value which defines inaccessible cells, 
	\item $M$ - Moore neighbourhood size
\end{itemize}



\subsection{Generative grammars}

Generative grammars are systems of rules that can be used to synthesize constructs of symbols, according to a given set of rules. Classically, generative grammars have been developed in the field of linguistic theory where Noam Chomsky laid the foundations for formal grammars in the 1950s. 

\td{Sportelli, Francesco \& Toto, Giuseppe \& Vessio, Gennaro. (2014). A Probabilistic Grammar for Procedural Content Generation. 10.13140/2.1.3820.4163. } 

\td{Shape grammars}

\td{grammars not optimal for generating irregular shapes}

\subsection{Other methods}

\td{Genetic algorithms, constraint-based, Perlin noise, others mentioned in surveys}

%%%%%%%%%%%%%%%
\section{Chosen method: cellular automata}

\td{short paragraph on the choice of CA for game maps - why CA and not other methods?}
\td{what are pros and cons of such choice?}
\td{desired characteristics of generated content: irregular, chaotic, resembling natural landmass}  
\td{desired feature: integrating manual editing and PCG - CA approach allows to edit between steps}
\td{reduced human effort to create maps, as in other PCG solutions}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\chapter{Generating and visualizing maps - proposed solution} \label{rozdzial.praktyka} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

To describe the developed solution concisely, this chapter consists of five sections: definition of required features, design of simple CA simulation and map generator models, followed by implementing them in C++ programming language and description of performed experiments.

%%%%%%%%%%%%%%%
\section{Analysis of requirements for a map generator}
 
 The following sections will:
 
\begin{itemize}
	\item define features required of a map generator program to automate creating maps,
	\item state the desired properties of such generator,
	\item discover to what constraints such program may be required to conform.
\end{itemize}

\subsection{Functional requirements}

First, we must define the desired functions which a useful map generator must provide to its user.
Since we have selected an approach to map generation based on cellular automata in chapter \ref{rozdzial.teoria}, we have to include simulation of CA states. As described in \autocite{johnson2010cellular}, our approach consists of generating a random image, which after several transformations performed by CA rules becomes structured with island-like features. Such image can then be used as a tile for larger maps. Showing each step of image transformation could be useful to the designer, allowing them to control what kind of generated tiles will be chosen to compose the map. 

Another potentially useful feature would be manual editing of tiles before they are placed in the map, which would allow for an even greater degree of control over tile contents. Further expansion of such feature could be to provide the designer with tools to make their own rules for tile generation, while also allowing them to define types of single cells composing the tile.

Finally, a map generator without a mechanism for saving the work done by a designer would certainly not be a useful tool. Such program needs a way to export generated maps to a file format that later can be used by a game engine of choice, possibly with procedures written by other programmers. Although saving or exporting maps is not really necessary for experimentation and testing, a production version of the program should have such functionality. To summarize desired functions, map generator program:

\begin{enumerate}
	\item must implement a cellular automaton to generate map tiles,
	\item must show generation stages graphically,
	\item must allow building maps from components (tiles),
	\item must have a mechanism for exporting generated maps,
	\item should allow manual editing of map tiles,

	\item \td{expand desired functions}
\end{enumerate}

\subsection{Non-functional requirements}

\td{}

\begin{enumerate}
	\item  must have a graphical user interface.
	\item The GUI must allow to change generation parameters, which should be grouped and ordered.  
	\item \td{add missing non-functional requirements}
\end{enumerate}

\subsection{Constraints}

\begin{enumerate}  
	\item \td{?}
\end{enumerate}

%%%%%%%%%%%%%%%
\section{Design}
\subsection{Data structures and persistence}

\td{ how do we store data?}
\td{ diagrams of cell, board}
\td{ exporting data from generator? }
\td{ how designers can get a complete map model? } 

\subsection{Application logic} 

\td{how a generator will work}
\td{behavior diagrams}

\subsection{User interface}

\td{OpenGL immediate mode paradigm}
\td{imgui immediate mode user interface library}

\begin{figure}[h]
	\centering
	\includegraphics[width=0.8\linewidth]{diagrams/uiwindows}
	\caption[User Interface model]{Example model of classes to be used to construct user interface in the map generator program}
	\label{fig:uiwindows}
\end{figure}

\td{diagram of texture class, used by Component MapGen, uses OpenGL}

\td{mention Bret Victor talks - why we choose Immediate Mode}


%%%%%%%%%%%%%%%
\section{Basic cellular automata simulations}

Having chosen cellular automata as a method for generating maps, it is helpful to find resources on the topic of building cellular automata simulations. One of them is chapter 7 in Nature of Code, a book by Daniel Shiffman \autocite{shiffman2012nature}, where one can find a short tutorial to build our first CA simulation. Author describes elementary concepts needed to construct a basic CA, explains how to implement a working simulation and provides helpful exercises, which may be preferable, since examples presented in New Kind of Science \autocite{wolfram2002new} are implemented in the Wolfram language and would require familiarity with it. As stated in Nature of Code \autocite{shiffman2012nature}, a 2-dimensional CA would need the following key elements to be simulated:

\begin{itemize}
	\item Cell state - every cell has a state updated on each simulation step,
	\item Grid - a space on which cells are placed,
	\item Neighbourhood - each cell needs to know the state of its neighbours to update its state.
\end{itemize}

In order to represent the cells of an automaton, a primitive data type is sufficient. However, we could design a class which will act as a collection of cells and provide additional utility to its user. Figure \ref{fig:boardcell} presents an example model of a class that would encapsulate a collection of cell states while also preserving information about the board on which those cells are placed. 

\begin{figure}[h]
	\centering
	\includegraphics[width=0.8\linewidth]{diagrams/boardcell01}
	\caption{ A possible model of a Board Class which holds cell states in its block of memory and lets its user change their states} 
	\label{fig:boardcell}
\end{figure}

We can also assign a number to each cell \td{why?} as shown in table \ref{tab:cellneighbors}.

\begin{table}[h]
	\centering
	\begin{tabular}{| l | l | l |}
		\hline 
		0 & 1 & 2 \\
		\hline
		7 & S & 3 \\
		\hline
		6 & 5 & 4 \\ 
		\hline
	\end{tabular}
	\caption{Cell neighbours, numbered. \textit{S} denotes selected cell. Cells marked with odd numbers are members of Moore neighborhood of selected cell and all numbered cells are members of Von Neumann neighbourhood of it. }
	\label{tab:cellneighbors}
\end{table}


Such abstraction creates an easy to use interface for further development and is also sufficient to access the values of neighbors to the selected cell. However, in some CA simulations summing the values of cells in neighbourhood is a common operation, so we can include variations of it for convenience. Similarly, a method to translate cell states into texture points would be welcome, since we may possibly need a way to display the state of CA board on screen. Adding those elements to our abstraction yields a class presented on figure \ref{fig:boardcell2}.
 
 \begin{figure}[h]
 	\centering
 	\includegraphics[width=0.8\linewidth]{diagrams/boardcell02}
 	\caption{ Revised Board abstraction - added methods for neighbor sums and translation of cell states to texels} 
 	\label{fig:boardcell2}
 \end{figure}

\td{add neighbor methods to board2}
\td{result of what it all does?}

At this point, we could also observe a common property of cellular automata  - whenever cell states need to change (the simulation moves to a later step), the state change is applied to every cell in the grid before simulation step ends \autocite{wolfram1984cellular} and cells do not need to be updated in sequence if only all cells will be changed before the next step. Hence, cell state updates could be applied in parallel to reduce the time needed to compute the simulation step. One way to do so would be to apply the findings presented by Reno Fourie in his thesis about applying CUDA technology to reduce time to compute next state of the board in case of 2-dimensional cellular automata \autocite{fourie2015parallel}.

\td{what else to include?}


%%%%%%%%%%%%%%%
\section{Implementation}

\td{describe how it all works now, with object diagrams}
\td{refer to code itself}


%%%%%%%%%%%%%%%
\section{Experiments in generating maps with CA}


\begin{figure}[h]
	\centering
	\begin{subfigure}[b]{0.2\textwidth}
		\centering
		\includegraphics[width=\textwidth]{images/step1}
		\caption{Step 1 - random noise} 
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.2\textwidth}
		\centering
		\includegraphics[width=\textwidth]{images/step2}
		\caption{Step 2 - generated tile} 
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.2\textwidth}
		\centering
		\includegraphics[width=\textwidth]{images/step3}
		\caption{Step 3 - tiles in a grid} 
	\end{subfigure}
	\hfill
	\begin{subfigure}[b]{0.2\textwidth}
		\centering
		\includegraphics[width=\textwidth]{images/step4}
		\caption{Step 4 - complete map} 
	\end{subfigure}
	\caption{Four stages of map construction}
	\label{fig:map_steps}
\end{figure}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Conclusions} \label{rozdzial.podsumowanie}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

/td{Co do conclusion to prosze zebrać wnioski, nie przemyślenia, z całego 
	tego projektu i opisać wady i zalety Pana rozwiązania. Czemu jest inne 
	niz wszystkie co wprowadza nowego a co starego naprawia.}

%%%%%%%%%%%%%%%
\section{Evaluation of results} 

\subsection{Effectiveness} 
\subsection{Cost} 

%%%%%%%%%%%%%%%
\section{Possible improvements}

\td{future: expanding the generator}
\td{future: adding more rules}
\td{future: user defined cell types}
\td{future: non-discrete cell states or more complex cell types }
\td{future: 3d maps?}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% KONIEC PRACY %%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\printbibliography[heading=bibintoc]

\addcontentsline{toc}{chapter}{List of figures} 
\listoffigures

\addcontentsline{toc}{chapter}{List of tables} 
\listoftables 

\addcontentsline{toc}{chapter}{Attachments} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter*{Attachments}
\begin{enumerate} 
\item \td{include thesis defence documents}
\item \td{attach 1}
\item \td{attach 2}
\item \td{attach 3}
\end{enumerate} 

\end{document}
